
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Mappa Stazioni Meteo - Calabria</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map {
      height: 600px;
      width: 100%;
    }
    .temperature-label {
      background-color: white;
      border: 1px solid gray;
      border-radius: 8px;
      padding: 2px 5px;
      font-size: 12px;
      font-weight: bold;
      text-align: center;
    }
  </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
  var map = L.map('map').setView([39.3, 16.3], 9);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18,
    attribution: '&copy; OpenStreetMap'
  }).addTo(map);

  var stazioni = [
    {
      nome: "Amantea Spiaggia",
      lat: 39.13,
      lon: 16.07,
      id: "IAMANT6",
      apiKey: "844d02e7e12049ef8d02e7e120b9ef68",
      link: "#"
    },
    {
      nome: "Celico Montescuro",
      lat: 39.33,
      lon: 16.40,
      id: "ICELIC1",
      apiKey: "844d02e7e12049ef8d02e7e120b9ef68",
      link: "#"
    },
    {
      nome: "Cosenza Campagnano",
      lat: 39.31,
      lon: 16.23,
      id: "ICOSEN20",
      apiKey: "844d02e7e12049ef8d02e7e120b9ef68",
      link: "#"
    },
    {
      nome: "Mendicino Tivolille Pasquali",
      lat: 39.28,
      lon: 16.20,
      id: "IMENDI13",
      apiKey: "844d02e7e12049ef8d02e7e120b9ef68",
      link: "#"
    },
    {
      nome: "Cosenza Vaglio Lise",
      lat: 39.32,
      lon: 16.26,
      id: "ICOSEN11",
      apiKey: "03d402e1e8844ac49402e1e8844ac419",
      link: "#"
    },
    {
      nome: "Casali del Manco Morelli Soprana",
      lat: 39.28,
      lon: 16.29,
      id: "ICASAL40",
      apiKey: "",
      link: "#"
    }
  ];

  stazioni.forEach(function(stazione) {
    if (!stazione.apiKey) {
      var marker = L.marker([stazione.lat, stazione.lon]).addTo(map)
        .bindPopup(`<b>${stazione.nome}</b><br><i>In attesa di API Key</i>`);
      return;
    }

    fetch(`https://api.weather.com/v2/pws/observations/current?stationId=${stazione.id}&format=json&units=m&apiKey=${stazione.apiKey}`)
      .then(response => response.json())
      .then(data => {
        const obs = data.observations[0];

        const temperatura = obs.metric.temp;
        const umidita = obs.humidity;
        const vento = obs.windSpeed;
        const raffica = obs.windGust;
        const tempMax = obs.metric.tempHigh24Hour;
        const tempMin = obs.metric.tempLow24Hour;

        var marker = L.marker([stazione.lat, stazione.lon]).addTo(map);

        marker.bindPopup(`
          <b>${stazione.nome}</b><br>
          Temperatura: <b>${temperatura} °C</b><br>
          Umidità: ${umidita}%<br>
          Vento: ${vento} km/h<br>
          Raffica massima: ${raffica} km/h<br>
          Max: ${tempMax} °C - Min: ${tempMin} °C<br><br>
          <a href="${stazione.link}" target="_blank">Vai alla pagina della stazione</a>
        `);

        var tempIcon = L.divIcon({
          className: 'temperature-label',
          html: `${temperatura}°C`,
          iconSize: [30, 30],
          iconAnchor: [15, 15]
        });

        L.marker([stazione.lat, stazione.lon], {icon: tempIcon}).addTo(map);
      })
      .catch(error => {
        console.error('Errore caricando dati per', stazione.nome, error);
      });
  });

</script>

</body>
</html>
